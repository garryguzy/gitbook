{"version":3,"sources":["../../../src/output/json/onFinish.js"],"names":["path","require","Promise","fs","JSONUtils","onFinish","output","book","getBook","outputRoot","getRoot","urls","getURLIndex","isMultilingual","languages","getLanguages","mainLanguage","getDefaultLanguage","readFile","resolve","getID","then","content","json","JSON","parse","encodeLanguages","writeFile","stringify","thenResolve","module","exports"],"mappings":";;AAAA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;;AAEA,IAAMC,UAAUD,QAAQ,qBAAR,CAAhB;AACA,IAAME,KAAKF,QAAQ,gBAAR,CAAX;AACA,IAAMG,YAAYH,QAAQ,YAAR,CAAlB;;AAEA;;;;;;AAMA,SAASI,QAAT,CAAkBC,MAAlB,EAA0B;AACtB,QAAMC,OAAOD,OAAOE,OAAP,EAAb;AACA,QAAMC,aAAaH,OAAOI,OAAP,EAAnB;AACA,QAAMC,OAAOL,OAAOM,WAAP,EAAb;;AAEA,QAAI,CAACL,KAAKM,cAAL,EAAL,EAA4B;AACxB,eAAOX,QAAQI,MAAR,CAAP;AACH;;AAED;AACA,QAAMQ,YAAYP,KAAKQ,YAAL,EAAlB;AACA,QAAMC,eAAeF,UAAUG,kBAAV,EAArB;;AAEA;AACA,WAAOd,GAAGe,QAAH,CAAYlB,KAAKmB,OAAL,CAAaV,UAAb,EAAyBO,aAAaI,KAAb,EAAzB,EAA+C,aAA/C,CAAZ,EAA2E,MAA3E;;AAEP;AAFO,KAGNC,IAHM,CAGD,UAACC,OAAD,EAAa;AACf,YAAMC,OAAOC,KAAKC,KAAL,CAAWH,OAAX,CAAb;;AAEAC,aAAKT,SAAL,GAAiBV,UAAUsB,eAAV,CAA0BZ,SAA1B,EAAqC,IAArC,EAA2CH,IAA3C,CAAjB;;AAEA,eAAOY,IAAP;AACH,KATM,EAWNF,IAXM,CAWD,UAACE,IAAD,EAAU;AACZ,eAAOpB,GAAGwB,SAAH,CACH3B,KAAKmB,OAAL,CAAaV,UAAb,EAAyB,aAAzB,CADG,EAEHe,KAAKI,SAAL,CAAeL,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAFG,CAAP;AAIH,KAhBM,EAkBNM,WAlBM,CAkBMvB,MAlBN,CAAP;AAmBH;;AAEDwB,OAAOC,OAAP,GAAiB1B,QAAjB","file":"onFinish.js","sourcesContent":["const path = require('path');\n\nconst Promise = require('../../utils/promise');\nconst fs = require('../../utils/fs');\nconst JSONUtils = require('../../json');\n\n/**\n * Finish the generation\n *\n * @param {Output}\n * @return {Output}\n */\nfunction onFinish(output) {\n    const book = output.getBook();\n    const outputRoot = output.getRoot();\n    const urls = output.getURLIndex();\n\n    if (!book.isMultilingual()) {\n        return Promise(output);\n    }\n\n    // Get main language\n    const languages = book.getLanguages();\n    const mainLanguage = languages.getDefaultLanguage();\n\n    // Read the main JSON\n    return fs.readFile(path.resolve(outputRoot, mainLanguage.getID(), 'README.json'), 'utf8')\n\n    // Extend the JSON\n    .then((content) => {\n        const json = JSON.parse(content);\n\n        json.languages = JSONUtils.encodeLanguages(languages, null, urls);\n\n        return json;\n    })\n\n    .then((json) => {\n        return fs.writeFile(\n            path.resolve(outputRoot, 'README.json'),\n            JSON.stringify(json, null, 4)\n        );\n    })\n\n    .thenResolve(output);\n}\n\nmodule.exports = onFinish;\n"]}