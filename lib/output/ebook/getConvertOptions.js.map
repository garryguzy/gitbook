{"version":3,"sources":["../../../src/output/ebook/getConvertOptions.js"],"names":["extend","require","Promise","getPDFTemplate","getCoverPath","getConvertOptions","output","options","getOptions","format","get","book","getBook","config","getConfig","then","coverPath","getValue","getLanguage","undefined","all","spread","headerTpl","footerTpl","pdfOptions","toJS","String","chapterMark","pageBreaksBefore","margin","left","right","top","bottom","fontSize","paperSize","Boolean","pageNumbers","fontFamily","module","exports"],"mappings":";;AAAA,IAAMA,SAASC,QAAQ,QAAR,CAAf;;AAEA,IAAMC,UAAUD,QAAQ,qBAAR,CAAhB;AACA,IAAME,iBAAiBF,QAAQ,kBAAR,CAAvB;AACA,IAAMG,eAAeH,QAAQ,gBAAR,CAArB;;AAEA;;;;;;AAMA,SAASI,iBAAT,CAA2BC,MAA3B,EAAmC;AAC/B,QAAMC,UAAUD,OAAOE,UAAP,EAAhB;AACA,QAAMC,SAASF,QAAQG,GAAR,CAAY,QAAZ,CAAf;;AAEA,QAAMC,OAAOL,OAAOM,OAAP,EAAb;AACA,QAAMC,SAASF,KAAKG,SAAL,EAAf;;AAEA,WAAOZ,UACNa,IADM,CACD,YAAM;AACR,YAAMC,YAAYZ,aAAaE,MAAb,CAAlB;AACA,YAAIC,UAAU;AACV,uBAAgCS,SADtB;AAEV,uBAAgCH,OAAOI,QAAP,CAAgB,OAAhB,CAFtB;AAGV,0BAAgCJ,OAAOI,QAAP,CAAgB,aAAhB,CAHtB;AAIV,sBAAgCJ,OAAOI,QAAP,CAAgB,MAAhB,CAJtB;AAKV,yBAAgCJ,OAAOI,QAAP,CAAgB,QAAhB,CALtB;AAMV,0BAAgCN,KAAKO,WAAL,MAAsBL,OAAOI,QAAP,CAAgB,UAAhB,CAN5C;AAOV,+BAAgC,SAPtB;AAQV,2BAAgC,SARtB;AASV,yBAAgC,oGATtB;AAUV,4BAAgC,sGAVtB;AAWV,4BAAgC,sGAXtB;AAYV,4BAAgC,sGAZtB;AAaV,4BAAgC,GAbtB;AAcV,oCAAgC,IAdtB;AAeV,+BAAgC,IAftB;AAgBV,2CAAgCR,WAAW,MAAX,GAAoB,IAApB,GAA2BU;AAhBjD,SAAd;;AAmBA,YAAIV,WAAW,KAAf,EAAsB;AAClB,mBAAOF,OAAP;AACH;;AAED,eAAOL,QAAQkB,GAAR,CAAY,CACfjB,eAAeG,MAAf,EAAuB,QAAvB,CADe,EAEfH,eAAeG,MAAf,EAAuB,QAAvB,CAFe,CAAZ,EAINe,MAJM,CAIC,UAACC,SAAD,EAAYC,SAAZ,EAA0B;AAC9B,gBAAMC,aAAaX,OAAOI,QAAP,CAAgB,KAAhB,EAAuBQ,IAAvB,EAAnB;;AAEA,mBAAOlB,UAAUP,OAAOO,OAAP,EAAgB;AAC7B,kCAA4BmB,OAAOF,WAAWG,WAAlB,CADC;AAE7B,wCAA4BD,OAAOF,WAAWI,gBAAlB,CAFC;AAG7B,iCAA4BF,OAAOF,WAAWK,MAAX,CAAkBC,IAAzB,CAHC;AAI7B,kCAA4BJ,OAAOF,WAAWK,MAAX,CAAkBE,KAAzB,CAJC;AAK7B,gCAA4BL,OAAOF,WAAWK,MAAX,CAAkBG,GAAzB,CALC;AAM7B,mCAA4BN,OAAOF,WAAWK,MAAX,CAAkBI,MAAzB,CANC;AAO7B,2CAA4BP,OAAOF,WAAWU,QAAlB,CAPC;AAQ7B,wCAA4BR,OAAOF,WAAWU,QAAlB,CARC;AAS7B,gCAA4BR,OAAOF,WAAWW,SAAlB,CATC;AAU7B,sCAA4BC,QAAQZ,WAAWa,WAAnB,CAVC;AAW7B,qCAA4BX,OAAOF,WAAWc,UAAlB,CAXC;AAY7B,yCAA4BhB,SAZC;AAa7B,yCAA4BC;AAbC,aAAhB,CAAjB;AAeH,SAtBM,CAAP;AAuBH,KAjDM,CAAP;AAkDH;;AAGDgB,OAAOC,OAAP,GAAiBnC,iBAAjB","file":"getConvertOptions.js","sourcesContent":["const extend = require('extend');\n\nconst Promise = require('../../utils/promise');\nconst getPDFTemplate = require('./getPDFTemplate');\nconst getCoverPath = require('./getCoverPath');\n\n/**\n    Generate options for ebook-convert\n\n    @param {Output}\n    @return {Promise<Object>}\n*/\nfunction getConvertOptions(output) {\n    const options = output.getOptions();\n    const format = options.get('format');\n\n    const book = output.getBook();\n    const config = book.getConfig();\n\n    return Promise()\n    .then(() => {\n        const coverPath = getCoverPath(output);\n        let options = {\n            '--cover':                      coverPath,\n            '--title':                      config.getValue('title'),\n            '--comments':                   config.getValue('description'),\n            '--isbn':                       config.getValue('isbn'),\n            '--authors':                    config.getValue('author'),\n            '--language':                   book.getLanguage() || config.getValue('language'),\n            '--book-producer':              'GitBook',\n            '--publisher':                  'GitBook',\n            '--chapter':                    'descendant-or-self::*[contains(concat(\\' \\', normalize-space(@class), \\' \\'), \\' book-chapter \\')]',\n            '--level1-toc':                 'descendant-or-self::*[contains(concat(\\' \\', normalize-space(@class), \\' \\'), \\' book-chapter-1 \\')]',\n            '--level2-toc':                 'descendant-or-self::*[contains(concat(\\' \\', normalize-space(@class), \\' \\'), \\' book-chapter-2 \\')]',\n            '--level3-toc':                 'descendant-or-self::*[contains(concat(\\' \\', normalize-space(@class), \\' \\'), \\' book-chapter-3 \\')]',\n            '--max-levels':                 '1',\n            '--no-chapters-in-toc':         true,\n            '--breadth-first':              true,\n            '--dont-split-on-page-breaks':  format === 'epub' ? true : undefined\n        };\n\n        if (format !== 'pdf') {\n            return options;\n        }\n\n        return Promise.all([\n            getPDFTemplate(output, 'header'),\n            getPDFTemplate(output, 'footer')\n        ])\n        .spread((headerTpl, footerTpl) => {\n            const pdfOptions = config.getValue('pdf').toJS();\n\n            return options = extend(options, {\n                '--chapter-mark':           String(pdfOptions.chapterMark),\n                '--page-breaks-before':     String(pdfOptions.pageBreaksBefore),\n                '--margin-left':            String(pdfOptions.margin.left),\n                '--margin-right':           String(pdfOptions.margin.right),\n                '--margin-top':             String(pdfOptions.margin.top),\n                '--margin-bottom':          String(pdfOptions.margin.bottom),\n                '--pdf-default-font-size':  String(pdfOptions.fontSize),\n                '--pdf-mono-font-size':     String(pdfOptions.fontSize),\n                '--paper-size':             String(pdfOptions.paperSize),\n                '--pdf-page-numbers':       Boolean(pdfOptions.pageNumbers),\n                '--pdf-sans-family':        String(pdfOptions.fontFamily),\n                '--pdf-header-template':    headerTpl,\n                '--pdf-footer-template':    footerTpl\n            });\n        });\n    });\n}\n\n\nmodule.exports = getConvertOptions;\n"]}