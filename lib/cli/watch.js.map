{"version":3,"sources":["../../src/cli/watch.js"],"names":["path","require","chokidar","Promise","FILE_EXTENSIONS","watch","dir","d","defer","resolve","toWatch","forEach","ext","push","watcher","cwd","ignored","ignoreInitial","once","e","filepath","close","err","reject","promise","module","exports"],"mappings":";;AAAA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,WAAWD,QAAQ,UAAR,CAAjB;;AAEA,IAAME,UAAUF,QAAQ,kBAAR,CAAhB;;eAC4BA,QAAQ,YAAR,C;IAApBG,e,YAAAA,e;;AAER;;;;;;;;AAMA,SAASC,KAAT,CAAeC,GAAf,EAAoB;AAChB,QAAMC,IAAIJ,QAAQK,KAAR,EAAV;AACAF,UAAMN,KAAKS,OAAL,CAAaH,GAAb,CAAN;;AAEA,QAAMI,UAAU,CACZ,WADY,EACC,SADD,EACY,aADZ,CAAhB;;AAIA;AACAN,oBAAgBO,OAAhB,CAAwB,UAACC,GAAD,EAAS;AAC7BF,gBAAQG,IAAR,CAAa,SAASD,GAAtB;AACH,KAFD;;AAIA,QAAME,UAAUZ,SAASG,KAAT,CAAeK,OAAf,EAAwB;AACpCK,aAAKT,GAD+B;AAEpCU,iBAAS,UAF2B;AAGpCC,uBAAe;AAHqB,KAAxB,CAAhB;;AAMAH,YAAQI,IAAR,CAAa,KAAb,EAAoB,UAACC,CAAD,EAAIC,QAAJ,EAAiB;AACjCN,gBAAQO,KAAR;;AAEAd,UAAEE,OAAF,CAAUW,QAAV;AACH,KAJD;AAKAN,YAAQI,IAAR,CAAa,OAAb,EAAsB,UAACI,GAAD,EAAS;AAC3BR,gBAAQO,KAAR;;AAEAd,UAAEgB,MAAF,CAASD,GAAT;AACH,KAJD;;AAMA,WAAOf,EAAEiB,OAAT;AACH;;AAEDC,OAAOC,OAAP,GAAiBrB,KAAjB","file":"watch.js","sourcesContent":["const path = require('path');\nconst chokidar = require('chokidar');\n\nconst Promise = require('../utils/promise');\nconst { FILE_EXTENSIONS } = require('../parsers');\n\n/**\n * Watch a folder and resolve promise once a file is modified\n *\n * @param {String} dir\n * @return {Promise}\n */\nfunction watch(dir) {\n    const d = Promise.defer();\n    dir = path.resolve(dir);\n\n    const toWatch = [\n        'book.json', 'book.js', '_layouts/**'\n    ];\n\n    // Watch all parsable files\n    FILE_EXTENSIONS.forEach((ext) => {\n        toWatch.push('**/*' + ext);\n    });\n\n    const watcher = chokidar.watch(toWatch, {\n        cwd: dir,\n        ignored: '_book/**',\n        ignoreInitial: true\n    });\n\n    watcher.once('all', (e, filepath) => {\n        watcher.close();\n\n        d.resolve(filepath);\n    });\n    watcher.once('error', (err) => {\n        watcher.close();\n\n        d.reject(err);\n    });\n\n    return d.promise;\n}\n\nmodule.exports = watch;\n"]}