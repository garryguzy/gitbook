{"version":3,"sources":["../../src/models/summaryArticle.js"],"names":["require","Record","List","location","DEFAULTS","level","String","title","ref","articles","SummaryArticle","get","getLevel","split","length","isExternal","undefined","getRef","parts","pathname","slice","join","flatten","anchor","subArticles","getArticles","childLevel","size","file","path","getPath","getAnchor","book","readme","getFile","getReadme","isFile","def","map","article","i","create","base","iter","reduce","result","findArticle","module","exports"],"mappings":"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","file":"summaryArticle.js","sourcesContent":["const { Record, List } = require('immutable');\n\nconst location = require('../utils/location');\n\nconst DEFAULTS = {\n    level:      String(),\n    title:      String(),\n    ref:        String(),\n    articles:   List()\n};\n\n/**\n * An article represents an entry in the Summary / table of Contents.\n * @type {Class}\n */\nclass SummaryArticle extends Record(DEFAULTS) {\n    getLevel() {\n        return this.get('level');\n    }\n\n    getTitle() {\n        return this.get('title');\n    }\n\n    getRef() {\n        return this.get('ref');\n    }\n\n    getArticles() {\n        return this.get('articles');\n    }\n\n    /**\n     * Return how deep the article is.\n     * The README has a depth of 1\n     *\n     * @return {Number}\n     */\n    getDepth() {\n        return (this.getLevel().split('.').length - 1);\n    }\n\n    /**\n     * Get path (without anchor) to the pointing file.\n     * It also normalizes the file path.\n     *\n     * @return {String}\n     */\n    getPath() {\n        if (this.isExternal()) {\n            return undefined;\n        }\n\n        const ref = this.getRef();\n        if (!ref) {\n            return undefined;\n        }\n\n        const parts = ref.split('#');\n\n        const pathname = (parts.length > 1 ? parts.slice(0, -1).join('#') : ref);\n\n        // Normalize path to remove ('./', '/...', etc)\n        return location.flatten(pathname);\n    }\n\n    /**\n     * Return url if article is external.\n     * @return {String}\n     */\n    getUrl() {\n        return this.isExternal() ? this.getRef() : undefined;\n    }\n\n    /**\n     * Get anchor for this article (or undefined).\n     * @return {String}\n     */\n    getAnchor() {\n        const ref = this.getRef();\n        const parts = ref.split('#');\n\n        const anchor = (parts.length > 1 ? '#' + parts[parts.length - 1] : undefined);\n        return anchor;\n    }\n\n    /**\n     * Create a new level for a new child article.\n     * @return {String}\n     */\n    createChildLevel() {\n        const level       = this.getLevel();\n        const subArticles = this.getArticles();\n        const childLevel  = level + '.' + (subArticles.size + 1);\n\n        return childLevel;\n    }\n\n    /**\n     * Is article pointing to a page of an absolute url.\n     * @return {Boolean}\n     */\n    isPage() {\n        return !this.isExternal() && this.getRef();\n    }\n\n    /**\n     * Check if this article is a file (exatcly)\n     *\n     * @param {File} file\n     * @return {Boolean}\n     */\n    isFile(file) {\n        return (\n            file.path === this.getPath()\n            && this.getAnchor() === undefined\n        );\n    }\n\n    /**\n     * Check if this article is the introduction of the book\n     *\n     * @param {Book|Readme} book\n     * @return {Boolean}\n     */\n    isReadme(book) {\n        const readme = book.getFile ? book : book.getReadme();\n        const file = readme.getFile();\n\n        return this.isFile(file);\n    }\n\n    /**\n     * Is article pointing to aan absolute url\n     *\n     * @return {Boolean}\n     */\n    isExternal() {\n        return location.isExternal(this.getRef());\n    }\n\n    /**\n     * Create a SummaryArticle\n     *\n     * @param {Object} def\n     * @return {SummaryArticle}\n     */\n    static create(def, level) {\n        const articles = (def.articles || []).map((article, i) => {\n            if (article instanceof SummaryArticle) {\n                return article;\n            }\n            return SummaryArticle.create(article, [level, i + 1].join('.'));\n        });\n\n        return new SummaryArticle({\n            level,\n            title: def.title,\n            ref: def.ref || def.path || '',\n            articles: List(articles)\n        });\n    }\n\n    /**\n     * Find an article from a base one\n     *\n     * @param {Article|Part} base\n     * @param {Function(article)} iter\n     * @return {Article}\n     */\n    static findArticle(base, iter) {\n        const articles = base.getArticles();\n\n        return articles.reduce((result, article) => {\n            if (result) return result;\n\n            if (iter(article)) {\n                return article;\n            }\n\n            return SummaryArticle.findArticle(article, iter);\n        }, null);\n    }\n}\n\nmodule.exports = SummaryArticle;\n"]}